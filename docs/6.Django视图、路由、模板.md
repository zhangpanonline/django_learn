# `Django` 视图、路由、模板

![0020.png](http://django_learn.zhangpan.online/static/0020.png)

## 一、 视图（View）：接收请求、处理业务逻辑

* 视图就是一个 `Python` 函数，被定义在 `应用` 的  `views.py` 中

* 视图的第一个参数是 `HttpRequest` 类型的对象 `request` ，包含了所有 `请求信息`

* 视图必须返回 `HttpResponse` 对象，包含返回給请求者的 `相应信息`

* 需要导入 `HttpResponse` 对象，`from django.http import HttpResponse`

  ```python
  # /bookmanager/book/views.py
  from django.http import HttpResponse
  
  def index(request):
      """
      视图函数有2个要求：
          1. 视图函数的第一个参数就是接收请求，这个请求就是从 django.http 导入的 HttpRequest 类的对象
          2. 必须返回一个响应
      """
      return HttpResponse('ok')
  ```

  

## 二、 路由（Route）：根据请求地址查找视图

### 2.1 路由的基本配置

访问 `http://10.10.22.232:8888/index/` ，页面显示 `404`，是因为路由还没有配置。

在 `bookmanager/bookmanager/urls.py` 里做如下修改：

```python
from django.contrib import admin
from django.urls import path
from book.views import index

urlpatterns = [
    path('admin/', admin.site.urls),
    path('index/', index)
]
```

再次访问 `http://10.10.22.232:8888/index/` 即可成功：

<img src="http://django_learn.zhangpan.online/static/0021.png" alt="0021.png" style="zoom:75%;" />

### 2.2 路由拆分

> 在每个子应用里写各子的路由，再统一在 `bookmanager/bookmanager/urls.py` 里进行引入

1. 在 `/bookmanager/book/` 下新建 `urls.py` 文件：

   ```python
   # /bookmanager/book/urls.py
   from django.urls import path
   from book.views import index
   # urlpatterns = []  固定写法
   urlpatterns = [
       # path(路由，视图函数名)
       path('index/', index)
   ]
   ```

2. 在 `/bookmanager/bookmanager/urls.py` 导入：

   ```python
   from django.contrib import admin
   from django.urls import path, include
   
   urlpatterns = [
       path('admin/', admin.site.urls),
       path('book/', include('book.urls'))
   ]
   ```

3. 访问 `http://10.10.22.232:8888/book/index/`

   <img src="http://django_learn.zhangpan.online/static/0022.png" alt="0022.png" style="zoom:75%;" />

   

## 三、 模板（Template）：编写 `html`、`css`、`js` 代码，编写模板语言代码

### 3.1 创建模板

创建如下路径的文件夹和模板文件：`/bookmanager/templates/book/index.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>模板渲染</h1>
</body>
</html>
```



### 3.2 模板配置

在 `/bookmanager/bookmanager/settings.py` 文件的 `TEMPLATES` 变量里的 `DIRS` 属性，添加如下代码 `os.path.join(BASE_DIR, 'templates')`，用来告知系统，我们的模板文件放在哪里

```python
# /bookmanager/bookmanager/settings.py
...
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        # 告知系统，我们的模板文件放在哪里
        'DIRS': [os.path.join(BASE_DIR, 'templates')],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
...
```

### 3.3  渲染模板

修改 `/bookmanager/book/views.py` 文件 `index` 函数的返回值

```python
from django.shortcuts import render


def index(request):
    return render(request, 'book/index.html')
```

访问 `http://10.10.22.232:8888/book/index/` 页面

<img src="http://django_learn.zhangpan.online/static/0023.png" alt="0023.png" style="zoom:75%;" />

### 3.4 在模板里获取变量的值

修改 `/bookmanager/book/views.py`：

```python
from django.shortcuts import render
def index(request):
    context = {
        'name': '动态值'
    }
    return render(request, 'book/index.html', context)
```

在模板里使用 `{{}}` 获取值：

```html
<h1>{{name}}</h1>
```

访问 `http://10.10.22.232:8888/book/index/`

<img src="http://django_learn.zhangpan.online/static/0024.png" alt="0024.png" style="zoom:75%;" />


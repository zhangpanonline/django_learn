# Python 的数据模型

> `Model` 用于和关系型数据库交互

## 1. 要实现的数据表结构如下

* 书籍信息表

  | 字段名 | 字段类型  | 字段说明 |
  | ------ | --------- | -------- |
  | id     | AutoField | 主键     |
  | name   | CharField | 书名     |

  | id   | name     |
  | ---- | -------- |
  | 1    | 西游记   |
  | 2    | 三国演义 |

* 人物信息表

  | 字段名 | 字段类型     | 字段说明 |
  | ------ | ------------ | -------- |
  | id     | AutoField    | 主键     |
  | name   | CharField    | 人名     |
  | gender | BooleanField | 性别     |
  | book   | ForeignKey   | 外键     |

  | id   | name   | gender | book |
  | ---- | ------ | ------ | ---- |
  | 1    | 孙悟空 | False  | 1    |
  | 2    | 白骨精 | True   | 1    |
  | 3    | 曹操   | False  | 2    |
  | 4    | 貂蝉   | True   | 2    |

## 2. `ORM 框架`介绍

`ORM`（Object Relational Mapping）对象关系映射，就是把数据库表的行与相应的对象建立关联，互相转换，使得数据库的操作面向对象。

由于 `Django` 的 `Model` 中内嵌了 `ORM` 框架，所以不需要直接面向数据库编程，而是定义模型类，通过 `模型类和对象`完成数据库的 `增删查改`。

>`ORM`						`DB`
>
>类		`<===>`	    数据表
>对象    `<====>`	  数据行
>属性	`<====>`	   字段

## 3. 使用 `Django` 进行数据库开发的步骤

### 3.1  定义模型类

```python
from django.db import models


"""
1. 我们的模型类需要继承自 models.Model
2. 系统会自动添加一个主键 id
3. 字段定义
    字段名=models.类型(选项)
    
    字段名不要使用 python、mysql 等关键字
"""


class BookInfo(models.Model):
    name = models.CharField(max_length=10)


# 人物
class PeopleInfo(models.Model):
    name = models.CharField(max_length=10)
    gender = models.BooleanField()
    # 外键
    book = models.ForeignKey(BookInfo, on_delete=models.CASCADE)
```



### 3.2 模型迁移

迁移由两部分完成：

1. 生成迁移文件：根据模型类生成创建表的语句

   ```shell
   python manage.py makemigrations
   ```

   此时 `/bookmanager/book/migrations` 下会多出一个 `0001_initial.py` 文件，这便是生成的迁移文件。

   

2. 执行迁移文件：根据第一步生成的语句在数据库中创建表

   ```shell
   python manage.py migrate
   ```

### 3.3 操作数据库

1. 上一步生成的数据表在哪查看呢？

   在 `/bookmanager/bookmanager/settings.py` 文件里可以看到如下代码：

   ```python
   # Database
   # https://docs.djangoproject.com/en/2.2/ref/settings/#databases
   
   DATABASES = {
       'default': {
           'ENGINE': 'django.db.backends.sqlite3',
           'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
       }
   }
   ```

   说明当前默认数据库用的是 `sqlite3` 数据库，存储数据的文件为 `/bookmanager/db.sqlite3`。

2. 查看 `sqlite3` 数据库

   首次查看，需要在 `pycharm` 里先安装对应的驱动，步骤如下：

   1. 双击 `/bookmanager/db.sqlite3` 文件；

   2. 下载驱动


   <img src="http://django_learn.zhangpan.online/static/15.png" alt="15.png" style="zoom:75%;" />

   此时在 `pycharm` 右侧 `Database` 里就能看到数据库了，在 `Database/db/main/tables` 下可以看到生成的 `book_bookinfo` 和 `book_peopleinfo` 两张表。


